import{l4 as w,l5 as d,l6 as D,l7 as F,l8 as p,l9 as A,dp as y,dy as v,la as S,lb as z,lc as m,gS as g,ld as E}from"./index-__5qT7pg.js";function $(t,e=!1){return t<=d?e?new Array(t).fill(0):new Array(t):w(t)}function K(t,e,r=null){const n=[],a=e.mapPositions,o=I(e,n),i=o.data,l=o.indices.length,u=D(l);return x(e,n,u),T(e,n,u),G(e,n,u),R(e,n,o.indices,u),j(e,n,o.indices,u),C(e,n),H(e,n,o.indices,u),M(e,n,i),new F(t,n,a,2,r)}function I(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,a=P(r)&&n,o=r.length/3-(a?1:0),i=new Array(2*(o-1)),l=a?r.slice(0,-3):r;let u=0;for(let s=0;s<o-1;s++)i[u++]=s,i[u++]=s+1;const c=new p(l,i,3,a);return e.push(["position",c]),c}function x(t,e,r){if(t.attributeData.colorFeature!=null)return;const n=t.attributeData.color;e.push(["color",new p(n??A,r,4)])}function G(t,e,r){t.attributeData.normal&&e.push(["normal",new p(t.attributeData.normal,r,3)])}function R(t,e,r,n){const a=t.attributeData.colorFeature;a!=null&&(typeof a=="number"?e.push(["colorFeatureAttribute",new p([a],n,1,!0)]):e.push(["colorFeatureAttribute",new p(a,r,1,!0)]))}function T(t,e,r){t.attributeData.sizeFeature==null&&e.push(["size",new p([t.attributeData.size??1],r,1,!0)])}function j(t,e,r,n){const a=t.attributeData.sizeFeature;a!=null&&(typeof a=="number"?e.push(["sizeFeatureAttribute",new p([a],n,1,!0)]):e.push(["sizeFeatureAttribute",new p(a,r,1,!0)]))}function C(t,e){const{attributeData:{position:r,timeStamps:n}}=t;if(!n)return;const a=r.length/3,o=new Array(2*(a-1));let i=0;for(let l=0;l<a-1;l++)o[i++]=l,o[i++]=l+1;e.push(["timeStamps",new p(n,o,h,!0)])}function H(t,e,r,n){const a=t.attributeData.opacityFeature;a!=null&&(typeof a=="number"?e.push(["opacityFeatureAttribute",new p([a],n,1,!0)]):e.push(["opacityFeatureAttribute",new p(a,r,1,!0)]))}function M(t,e,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==1||!t.overlayInfo.spatialReference.isGeographic)return;const n=y(r.length),a=v(t.overlayInfo.spatialReference);for(let f=0;f<n.length;f+=3)S(r,f,n,f,a);const o=r.length/3,i=z(o+1);let l=U,u=k,c=0,s=0;m(l,n[s++],n[s++]),s++,i[0]=0;for(let f=1;f<o+1;++f)f===o&&(s=0),m(u,n[s++],n[s++]),s++,c+=E(l,u),i[f]=c,[l,u]=[u,l];e.push(["distanceToStart",new p(i,e[0][1].indices,1,!0)])}function P(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const U=g(),k=g(),h=4;function q(t,e,r,n,a){if(t==null||t.length===0)return[];const o=[];return t.forEach((i,l)=>{const u=i.length,c=y(3*u);i.forEach((f,b)=>{c[3*b]=f[0],c[3*b+1]=f[1],c[3*b+2]=f[2]});const s={attributeData:{position:c,normal:e,colorFeature:r?.[l],opacityFeature:n?.[l],sizeFeature:a?.[l]},removeDuplicateStartEnd:!1};o.push(s)}),o}function L(t,e,r,n,a,o){if(t==null||t.length===0)return[];const i=q(t,e,n,a,o);return t.forEach((l,u)=>{const c=r?.[u],s=c!=null?B(c.timeStamps,c.streamlineType):void 0;i[u].attributeData.timeStamps=s}),i}function B(t,e){const r=$(t.length*h),n=t[0],a=t[t.length-1];for(let o=0;o<t.length;o++)r[o*h]=t[o],r[o*h+1]=n,r[o*h+2]=a,r[o*h+3]=e+.5;return r}export{L as E,q as S,K as f,$ as n};
